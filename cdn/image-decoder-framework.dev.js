var r=function(){function d(b,d){this.O=b;this.g=this.w=d;this.s=Array(this.w);this.N=[]}function b(b,d){this.i=b;this.v=d}d.prototype.R=function(b,d){if(0<this.g){--this.g;var g=this.s.pop();void 0===g&&(g=this.O());this.U(b,g,d)}else this.N.push({K:b,c:d})};d.prototype.U=function(d,l,g){d(l,g,new b(this,l))};b.prototype.jobDone=function(){if(0<this.i.N.length){var b=this.i.N.pop();this.i.U(b.K,this.v,b.c)}else this.i.s.push(this.v),++this.i.g};b.prototype.shouldYieldOrAbort=function(){return!1};
b.prototype.tryYield=function(){return!1};return d}();var t=function(){function d(){this.clear()}d.prototype.clear=function(){this.H={h:null,I:this};this.A={o:null,I:this};this.m=0;this.A.h=this.H;this.H.o=this.A};d.prototype.add=function(b,d){if(null===d||void 0===d)d=this.A;this.B(d);++this.m;var l={Y:b,o:d,h:d.h,I:this};l.h.o=l;return d.h=l};d.prototype.remove=function(b){this.B(b);--this.m;b.h.o=b.o;b.o.h=b.h;b.I=null};d.prototype.J=function(b){this.B(b);return b.Y};d.prototype.C=function(){return this.D(this.H)};d.prototype.Z=function(){return this.$(this.A)};
d.prototype.D=function(b){this.B(b);return b.o===this.A?null:b.o};d.prototype.$=function(b){this.B(b);return b.h===this.H?null:b.h};d.prototype.B=function(b){if(b.I!==this)throw"iterator must be of the current LinkedList";};return d}();var v=function(){function d(a,h,c,e){e=e||{};this.O=a;this.w=h;this.l=c;this.f=e.showLog;this.V=e.schedulerName;this.M=e.numNewJobs||20;this.W=e.numJobsBeforeRerankOldPriorities||20;this.g=this.w;this.s=Array(this.w);this.X=e.resourcesGuaranteedForHighPriority||0;this.u=">";this.j=0;this.b=[];this.a=new t;this.P=0}function b(a,h){f(a,"tryDequeueNewJobWithHigherPriority() start",1);for(var c=null,e=h,b=[],k=a.a.C();null!==k;){var d=a.a.D(k),l=a.a.J(k),g=a.l.getPriority(l.c);if(0>g)p(a,k),--a.j,l.F(l.c);
else{if(void 0===e||g>e)e=g,c=k;a.f&&(void 0===b[g]?b[g]=1:++b[g])}k=d}k=null;null!==c&&(k=p(a,c),--a.j);if(a.f){c="tryDequeueNewJobWithHigherPriority(): Jobs list:";for(d=0;d<b.length;++d)void 0!==b[d]&&(c+=b[d]+" jobs of priority "+d+";");f(a,c);null!==k&&f(a,"tryDequeueNewJobWithHigherPriority(): dequeued new job of priority "+e)}m(a);f(a,"tryDequeueNewJobWithHigherPriority() end",-1);return k}function u(a,h,c){f(a,"enqueueNewJob() start",1);++a.j;var e=a.a.C();w(a,h,e);a.f&&f(a,"enqueueNewJob(): enqueued job of priority "+
c);a.a.m<=a.M?(m(a),f(a,"enqueueNewJob() end: _newPendingJobsLinkedList is small enough",-1)):(h=a.a.Z(),h=p(a,h),l(a,h),m(a),f(a,"enqueueNewJob() end: One job moved from new job list to old job list",-1))}function l(a,h){f(a,"enqueueOldJob() start",1);var c=a.l.getPriority(h.c);0>c?(--a.j,h.F(h.c),f(a,"enqueueOldJob() end: job aborted",-1)):(void 0===a.b[c]&&(a.b[c]=[]),a.b[c].push(h),f(a,"enqueueOldJob() end: job enqueued to old job list",-1))}function g(a,h){f(a,"resourceFreed() start",1);++a.g;
var c=x(a);--a.g;c=b(a,c);if(null!==c)m(a),q(a,c,h),m(a),f(a,"resourceFreed() end: new job scheduled",-1);else if(a.j>a.a.m){for(var e,d=a.b.length-1;0<=d;--d){var k=a.b[d];if(void 0!==k&&0!==k.length){for(var g=k.length-1;0<=g;--g){c=k[g];e=a.l.getPriority(c.c);if(e>=d){k.length=g;break}else 0>e?(--a.j,c.F(c.c)):(void 0===a.b[e]&&(a.b[e]=[]),a.b[e].push(c));c=null}if(null!==c)break;k.length=0}}null===c?(a.s.push(h),++a.g,m(a),f(a,"resourceFreed() end: no non-aborted job to schedule",-1)):(a.f&&f(a,
"resourceFreed(): dequeued old job of priority "+e),--a.j,m(a),q(a,c,h),m(a),f(a,"resourceFreed() end: job scheduled",-1))}else a.s.push(h),++a.g,m(a),f(a,"resourceFreed() end: no job to schedule",-1)}function q(a,h,c){f(a,"schedule() start",1);++a.P;if(a.P>=a.W){a.P=0;f(a,"rerankPriorities() start",1);var e=a.b,d=a.a;if(0===e.length)f(a,"rerankPriorities() end: no need to rerank",-1);else{a.b=[];a.a=new t;for(var b=0;b<e.length;++b)if(void 0!==e[b])for(var g=0;g<e[b].length;++g)l(a,e[b][g]);for(b=
d.C();null!==b;)e=d.J(b),l(a,e),b=d.D(b);d="rerankPriorities(): ";for(b=a.b.length-1;0<=b;--b)if(e=a.b[b],void 0!==e){for(a.f&&(d+=e.length+" jobs in priority "+b+";");0<e.length&&a.a.m<a.M;)g=e.pop(),w(a,g);if(a.a.m>=a.M&&!a.f)break}a.f&&f(a,d);m(a);f(a,"rerankPriorities() end: rerank done",-1)}}a.f&&(b=a.l.getPriority(h.c),f(a,"schedule(): scheduled job of priority "+b));h.K(c,h.c,new n(a,c,h.c));f(a,"schedule() end",-1)}function w(a,b,c){f(a,"addJobToLinkedList() start",1);a.a.add(b,c);y(a);f(a,
"addJobToLinkedList() end",-1)}function p(a,b){f(a,"extractJobFromLinkedList() start",1);var c=a.a.J(b);a.a.remove(b);y(a);f(a,"extractJobFromLinkedList() end",-1);return c}function y(a){if(a.f){f(a,"ensureNumberOfNodes() start",1);for(var b=a.a.C(),c=0;null!==b;)++c,b=a.a.D(b);if(c!==a.a.m)throw"Unexpected count of new jobs";f(a,"ensureNumberOfNodes() end",-1)}}function m(a){if(a.f){f(a,"ensurePendingJobsCount() start",1);for(var b=0,c=0;c<a.b.length;++c){var e=a.b[c];void 0!==e&&(b+=e.length)}if(b+
a.a.m!==a.j)throw"Unexpected count of jobs";f(a,"ensurePendingJobsCount() end",-1)}}function x(a){f(a,"getMinimalPriorityToSchedule() start",1);if(a.g<=a.X)return f(a,"getMinimalPriorityToSchedule() end: guarantee resource for high priority is needed",-1),a.aa;f(a,"getMinimalPriorityToSchedule() end: enough resources, no need to guarantee resource for high priority",-1);return 0}function f(a,b,c){a.f&&(-1===c&&(a.u=a.u.substr(1)),void 0!==a.V?console.log(a.u+"PriorityScheduler "+a.V+": "+b):console.log(a.u+
"PriorityScheduler: "+b),1===c&&(a.u+=">"))}function n(a,b,c){this.T=!0;this.i=a;this.v=b;this.G=c}d.prototype.R=function(a,b,c){f(this,"enqueueJob() start",1);var e=this.l.getPriority(b);0>e?(c(b),f(this,"enqueueJob() end: job aborted",-1)):(a={K:a,F:c,c:b},b=x(this),c=null,e>=b&&(f(this,"tryGetFreeResource() start",1),0===this.g?c=null:(--this.g,b=this.s.pop(),void 0===b&&(b=this.O()),m(this),f(this,"tryGetFreeResource() end",-1),c=b)),null!==c?(q(this,a,c),f(this,"enqueueJob() end: job scheduled",
-1)):(u(this,a,e),m(this),f(this,"enqueueJob() end: job pending",-1)))};n.prototype.L=function(){if(!this.T)throw"ResourceScheduler error: Already terminated job";};n.prototype.S=function(){this.T=!1;this.i=this.G=this.v=null};n.prototype.jobDone=function(){this.L();var a=this.i,b=this.v;if(a.f){var c=a.l.getPriority(this.G);f(a,"jobDone() start: job done of priority "+c,1)}g(a,b);m(a);f(a,"jobDone() end",-1);this.S()};n.prototype.shouldYieldOrAbort=function(){this.L();var a=this.i,b=this.G;f(a,"shouldYieldOrAbort() start",
1);var b=a.l.getPriority(b),c;if(!(c=0>b))a:{c=a.a.C();for(f(a,"hasNewJobWithHigherPriority() start",1);null!==c;){var e=a.a.D(c),d=a.a.J(c),g=a.l.getPriority(d.c);if(0>g)p(a,c),--a.j,d.F(d.c);else if(g>b){f(a,"hasNewJobWithHigherPriority() end: returns true",-1);c=!0;break a}c=e}f(a,"hasNewJobWithHigherPriority() end: returns false",-1);c=!1}b=c;f(a,"shouldYieldOrAbort() end",-1);return b};n.prototype.tryYield=function(a,d,c){this.L();var e=this.i,l=this.G,k=this.v;f(e,"tryYield() start",1);var n=
e.l.getPriority(l);if(0>n)d(l),g(e,k),f(e,"tryYield() end: job aborted",-1),a=!0;else{var p=b(e,n);m(e);null===p?(f(e,"tryYield() end: job continues",-1),a=!1):(c(l),u(e,{K:a,F:d,c:l},n),m(e),q(e,p,k),m(e),f(e,"tryYield() end: job yielded",-1),a=!0)}a&&this.S();return a};return d}();self.ResourceScheduler={};self.ResourceScheduler.PriorityScheduler=v;self.ResourceScheduler.LifoScheduler=r;v.prototype.enqueueJob=v.prototype.R;r.prototype.enqueueJob=r.prototype.R;

!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.imageDecoderFramework=e()}}(function(){return function e(t,i,r){function a(n,o){if(!i[n]){if(!t[n]){var h="function"==typeof require&&require;if(!o&&h)return h(n,!0);if(s)return s(n,!0);var l=new Error("Cannot find module '"+n+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[n]={exports:{}};t[n][0].call(c.exports,function(e){var i=t[n][1][e];return a(i?i:e)},c,c.exports,e,t,i,r)}return i[n].exports}for(var s="function"==typeof require&&require,n=0;n<r.length;n++)a(r[n]);return a}({1:[function(e,t,i){"use strict";function r(e){var t={x:e.scene.canvas.width,y:e.scene.canvas.height},i=[];a(0,0,t.x,t.y,i,e,0);var r=Cesium.Rectangle.fromCartographicArray(i);(r.east<r.west||r.north<r.south)&&(r={east:Math.max(r.east,r.west),west:Math.min(r.east,r.west),north:Math.max(r.north,r.south),south:Math.min(r.north,r.south)});var s=n.calculateFrustum2DFromBounds(r,t);return s}function a(e,t,i,r,n,h,l){var c=0;c+=s(e,t,h,n),c+=s(i,t,h,n),c+=s(e,r,h,n),c+=s(i,r,h,n);var u=o;if(!(4===c||l>=u)){++l;var d=(e+i)/2,_=(t+r)/2;a(e,t,d,_,n,h,l),a(e,_,d,r,n,h,l),a(d,t,i,_,n,h,l),a(d,_,i,r,n,h,l)}}function s(e,t,i,r){var a=new Cesium.Cartesian2(e,t),s=i.scene.mapProjection.ellipsoid,n=i.scene.camera.pickEllipsoid(a,s);if(void 0===n)return 0;var o=s.cartesianToCartographic(n);return void 0===o?0:(r.push(o),1)}t.exports=r;var n=e("imagehelperfunctions.js"),o=4},{"imagehelperfunctions.js":12}],2:[function(e,t,i){"use strict";function r(e,t){this._options=t||{},void 0!==this._options.rectangle&&(this._options=JSON.parse(JSON.stringify(t)),this._options.cartographicBounds={west:t.rectangle.west,east:t.rectangle.east,south:t.rectangle.south,north:t.rectangle.north}),this._options.minFunctionCallIntervalMilliseconds=t.minFunctionCallIntervalMilliseconds||100,this._url=t.url,this._targetCanvas=document.createElement("canvas"),this._imageryProviders=[new a(this._targetCanvas),new a(this._targetCanvas)],this._imageryLayerShown=new Cesium.ImageryLayer(this._imageryProviders[0]),this._imageryLayerPending=new Cesium.ImageryLayer(this._imageryProviders[1]),this._canvasUpdatedCallbackBound=this._canvasUpdatedCallback.bind(this),this._isPendingUpdateCallback=!1,this._isWhileReplaceLayerShown=!1,this._pendingPositionRectangle=null,this._image=new s(e,this._canvasUpdatedCallbackBound,this._options),this._image.setTargetCanvas(this._targetCanvas),this._updateFrustumBound=this._updateFrustum.bind(this),this._postRenderBound=this._postRender.bind(this)}t.exports=r;var a=e("canvasimageryprovider.js"),s=e("viewerimagedecoder.js"),n=e("_cesiumfrustumcalculator.js");r.prototype.setExceptionCallback=function(e){this._image.setExceptionCallback(e)},r.prototype.open=function(e){this._widget=e,this._layers=e.scene.imageryLayers,e.scene.postRender.addEventListener(this._postRenderBound),this._image.open(this._url),this._layers.add(this._imageryLayerShown),this._intervalHandle=setInterval(this._updateFrustumBound,500)},r.prototype.close=function(){this._image.close(),clearInterval(this._intervalHandle),this._layers.remove(this._imageryLayerShown),this._widget.removeEventListener(this._postRenderBound),this._isWhileReplaceLayerShown&&(this._isWhileReplaceLayerShown=!1,this._isPendingUpdateCallback=!1,this._layers.remove(this._imageryLayerPending))},r.prototype.getImageryLayers=function(){return[this._imageryLayerShown,this._imageryLayerPending]},r.prototype._updateFrustum=function(){var e=n(this._widget);null!==e&&this._image.updateViewArea(e)},r.prototype._canvasUpdatedCallback=function(e){if(this._isWhileReplaceLayerShown&&(this._isPendingUpdateCallback=!0,this._pendingPositionRectangle=e),null!==e){var t=new Cesium.Rectangle(e.west,e.south,e.east,e.north);this._imageryProviders[0].setRectangle(t),this._imageryProviders[1].setRectangle(t)}this._removeAndReAddLayer()},r.prototype._removeAndReAddLayer=function(){var e=this._layers.indexOf(this._imageryLayerShown);if(0>e)throw"Layer was removed from viewer's layers  without closing layer manager. Use CesiumImageDecoderLayerManager.close() instead";this._isWhileReplaceLayerShown=!0,this._layers.add(this._imageryLayerPending,e)},r.prototype._postRender=function(){if(this._isWhileReplaceLayerShown){this._isWhileReplaceLayerShown=!1,this._layers.remove(this._imageryLayerShown,!1);var e=this._imageryLayerShown;this._imageryLayerShown=this._imageryLayerPending,this._imageryLayerPending=e,this._isPendingUpdateCallback&&(this._isPendingUpdateCallback=!1,this._canvasUpdatedCallback(this._pendingPositionRectangle))}}},{"_cesiumfrustumcalculator.js":1,"canvasimageryprovider.js":3,"viewerimagedecoder.js":19}],3:[function(e,t,i){"use strict";function r(e,t){if(void 0===t&&(t={}),void 0===e)throw new DeveloperError("canvas is required.");this._canvas=e,this._errorEvent=new Event("CanvasImageryProviderStatus"),this._ready=!1;var i=t.credit;"string"==typeof i&&(i=new Credit(i)),this._credit=i}t.exports=r,r.prototype={get tileWidth(){if(!this._ready)throw new DeveloperError("tileWidth must not be called before the imagery provider is ready.");return this._canvas.width},get tileHeight(){if(!this._ready)throw new DeveloperError("tileHeight must not be called before the imagery provider is ready.");return this._canvas.height},get maximumLevel(){if(!this._ready)throw new DeveloperError("maximumLevel must not be called before the imagery provider is ready.");return 0},get minimumLevel(){if(!this._ready)throw new DeveloperError("minimumLevel must not be called before the imagery provider is ready.");return 0},get tilingScheme(){if(!this._ready)throw new DeveloperError("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme},get rectangle(){return this._tilingScheme.rectangle},get tileDiscardPolicy(){if(!this._ready)throw new DeveloperError("tileDiscardPolicy must not be called before the imagery provider is ready.")},get errorEvent(){return this._errorEvent},get ready(){return this._ready},get credit(){return this._credit},get hasAlphaChannel(){return!0}},r.prototype.setRectangle=function(e){this._tilingScheme=new Cesium.GeographicTilingScheme({rectangle:e,numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1}),this._ready||(this._ready=!0,Cesium.TileProviderError.handleSuccess(this._errorEvent))},r.prototype.getTileWidth=function(){return this.tileWidth},r.prototype.getTileHeight=function(){return this.tileHeight},r.prototype.getMaximumLevel=function(){return this.maximumLevel},r.prototype.getMinimumLevel=function(){return this.minimumLevel},r.prototype.isReady=function(){return this.ready},r.prototype.getCredit=function(){return this.credit},r.prototype.getRectangle=function(){return this.tilingScheme.rectangle},r.prototype.getTilingScheme=function(){return this.tilingScheme},r.prototype.getTileDiscardPolicy=function(){return this.tileDiscardPolicy},r.prototype.getErrorEvent=function(){return this.errorEvent},r.prototype.getHasAlphaChannel=function(){return this.hasAlphaChannel},r.prototype.getTileCredits=function(e,t,i){},r.prototype.requestImage=function(e,t,i){if(!this._ready)throw new DeveloperError("requestImage must not be called before the imagery provider is ready.");return this._canvas},r.prototype.pickFeatures=function(){}},{}],4:[function(e,t,i){"use strict";function r(e,t){var i=t.url;if(this._adaptProportions=t.adaptProportions,this._rectangle=t.rectangle,this._proxy=t.proxy,this._updateFrustumInterval=1e3,this._credit=t.credit,"string"==typeof this._credit&&(this._credit=new Credit(this._credit)),void 0===this._rectangle&&(this._rectangle=Cesium.Rectangle.fromDegrees(-180,-90,180,90)),void 0===this._adaptProportions&&(this._adaptProportions=!0),t=JSON.parse(JSON.stringify(t||{})),t.cartographicBounds={west:this._rectangle.west,east:this._rectangle.east,south:this._rectangle.south,north:this._rectangle.north},void 0===i)throw new DeveloperError("url is required.");this._url=i,this._tilingScheme=void 0,this._tileWidth=0,this._tileHeight=0,this._errorEvent=new Event("ImageDecoderImageryProviderStatus"),this._ready=!1,this._exceptionCallback=null,this._cesiumWidget=null,this._updateFrustumIntervalHandle=null;var r=i;if(void 0!==this._proxy&&(r=this._proxy.getURL(r)),this._image=e,this._levelCalculator=null,this._factory=e.getFactory(),!this._factory.getLevelCalculator)throw"ImageDecoder.getLevelCalculator() is not implemented by factory ctor argument!";this._url=r}function a(e){var t=new Cesium.Rectangle(e.west,e.south,e.east,e.north),i=new Cesium.GeographicTilingScheme({rectangle:t,numberOfLevelZeroTilesX:e.levelZeroTilesX,numberOfLevelZeroTilesY:e.levelZeroTilesY});return i}t.exports=r;var s=(e("workerproxyimagedecoder.js"),e("_cesiumfrustumcalculator.js")),n=e("imagehelperfunctions.js");r.prototype={get url(){return this._url},get proxy(){return this._proxy},get tileWidth(){if(!this._ready)throw new DeveloperError("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth},get tileHeight(){if(!this._ready)throw new DeveloperError("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight},get maximumLevel(){if(!this._ready)throw new DeveloperError("maximumLevel must not be called before the imagery provider is ready.");return this._numResolutionLevels-1},get minimumLevel(){if(!this._ready)throw new DeveloperError("minimumLevel must not be called before the imagery provider is ready.");return 0},get tilingScheme(){if(!this._ready)throw new DeveloperError("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme},get rectangle(){return this._tilingScheme.rectangle},get tileDiscardPolicy(){if(!this._ready)throw new DeveloperError("tileDiscardPolicy must not be called before the imagery provider is ready.")},get errorEvent(){return this._errorEvent},get ready(){return this._ready},get credit(){return this._credit},get hasAlphaChannel(){return!0}},r.prototype.setExceptionCallback=function(e){this._exceptionCallback=e},r.prototype.open=function(e){if(null!==this._updateFrustumIntervalHandle)throw new DeveloperError("Cannot set two parent viewers.");if(void 0===e)throw new DeveloperError("widgetOrViewer should be given. It is needed for frustum calculation for the priority mechanism");this._image.open(this._url).then(this._opened.bind(this))["catch"](this._onException.bind(this)),this._cesiumWidget=e,this._updateFrustumIntervalHandle=setInterval(this._setPriorityByFrustum.bind(this),this._updateFrustumInterval)},r.prototype.close=function(){clearInterval(this._updateFrustumIntervalHandle),this._image.close()},r.prototype.getTileWidth=function(){return this.tileWidth},r.prototype.getTileHeight=function(){return this.tileHeight},r.prototype.getMaximumLevel=function(){return this.maximumLevel},r.prototype.getMinimumLevel=function(){return this.minimumLevel},r.prototype.getUrl=function(){return this.url},r.prototype.getProxy=function(){return this.proxy},r.prototype.isReady=function(){return this.ready},r.prototype.getCredit=function(){return this.credit},r.prototype.getRectangle=function(){return this.tilingScheme.rectangle},r.prototype.getTilingScheme=function(){return this.tilingScheme},r.prototype.getTileDiscardPolicy=function(){return this.tileDiscardPolicy},r.prototype.getErrorEvent=function(){return this.errorEvent},r.prototype.getHasAlphaChannel=function(){return this.hasAlphaChannel},r.prototype.getTileCredits=function(e,t,i){},r.prototype.requestImage=function(e,t,i){function r(e){var t=e.imageData.width,i=e.imageData.height;t>0&&i>0&&T.putImageData(e.imageData,e.xInOriginalRequest,e.yInOriginalRequest)}function a(e){e?C("Fetch request or decode aborted"):(v.drawImage(P,0,0,f,y,g.croppedScreen.minX,g.croppedScreen.minY,g.croppedScreen.maxXExclusive,g.croppedScreen.maxYExclusive),w(p))}if(!this._ready)throw new DeveloperError("requestImage must not be called before the imagery provider is ready.");var s=this,o=Math.pow(2,this._numResolutionLevels-i-1),h=e*this._tileWidth*o,l=t*this._tileHeight*o,c=(e+1)*this._tileWidth*o,u=(t+1)*this._tileHeight*o,d=g.imagePartParams.level,_=this._levelCalculator.getLevelWidth(d),m=this._levelCalculator.getLevelHeight(d),g=n.alignParamsToTilesAndLevel({minX:h,minY:l,maxXExclusive:c,maxYExclusive:u,levelWidth:_,levelHeight:m,screenWidth:this._tileWidth,screenHeight:this._tileHeight},this._image,this._levelCalculator),p=document.createElement("canvas");p.width=this._tileWidth,p.height=this._tileHeight;var v=p.getContext("2d");v.clearRect(0,0,this._tileWidth,this._tileHeight);var f=g.imagePartParams.maxXExclusive-g.imagePartParams.minX,y=g.imagePartParams.maxYExclusive-g.imagePartParams.minY;if(0>=f||0>=y)return p;var P=document.createElement("canvas");P.width=f,P.height=y;var T=P.getContext("2d");T.clearRect(0,0,f,y),g.imagePartParams.quality=this._quality,g.imagePartParams.requestPriorityData={imageRectangle:this._rectangle};var w,C,x=new Promise(function(e,t){w=e,C=t,s._image.requestPixelsProgressive(g.imagePartParams,r,a)});return x},r.prototype._setPriorityByFrustum=function(){if(this._ready){var e=s(this._cesiumWidget,this);null!==e&&(e.imageRectangle=this.getRectangle(),e.exactlevel=null,this._image.setServerRequestPrioritizerData(e),this._image.setDecodePrioritizerData(e))}},r.prototype.pickFeatures=function(){},r.prototype._onException=function(e){null!==this._exceptionCallback&&this._exceptionCallback(e)},r.prototype._opened=function(){if(this._ready)throw"ImageDecoderImageryProvider error: opened() was called more than once!";this._ready=!0,this._levelCalculator=this._factory.getLevelCalculator(),this._numResolutionLevels=this._image.getNumResolutionLevelsForLimittedViewer(),this._quality=this._image.getHighestQuality();var e=this._numResolutionLevels-1;this._tileWidth=this._image.getTileWidth(),this._tileHeight=this._image.getTileHeight();var t=(this._image.getImageLevel(),this._image.getImageWidth()),i=this._image.getImageHeight(),r=Math.ceil(t/this._tileWidth)>>e,s=Math.ceil(i/this._tileHeight)>>e;n.fixBounds(this._rectangle,this._image,this._adaptProportions);var o=this._rectangle.east-this._rectangle.west,h=this._rectangle.north-this._rectangle.south,l=1<<e,c=this._tileWidth*r*l,u=this._tileHeight*s*l,d=o*c/t,_=h*u/i,m=this._rectangle.west+d,g=this._rectangle.north-_;this._tilingSchemeParams={west:this._rectangle.west,east:m,south:g,north:this._rectangle.north,levelZeroTilesX:r,levelZeroTilesY:s,maximumLevel:e},this._tilingScheme=a(this._tilingSchemeParams),Cesium.TileProviderError.handleSuccess(this._errorEvent)}},{"_cesiumfrustumcalculator.js":1,"imagehelperfunctions.js":12,"workerproxyimagedecoder.js":18}],5:[function(e,t,i){"use strict";function r(e,t){if(n.call(this),this._options=t||{},this._tileWidth=this._options.tileWidth||256,this._tileHeight=this._options.tileHeight||256,this._showLog=!!this._options.showLog,this._fetchManager=null,this._decodeDependencyWorkers=null,this._requestsDecodeJobsPool=null,this._channelsDecodeJobsPool=null,this._fetchRequestId=0,this._channelStates=[],this._decoders=[],this._image=e,!this._image.getFetchManager)throw"Image.getFetchManager() is not implemented by image ctor argument!";if(!this._image.getDecoderWorkers)throw"Image.getDecoderWorkers() is not implemented by image ctor argument"}t.exports=r;var a=e("imageHelperFunctions.js"),s=e("decodejobspool.js"),n=e("imageparamsretrieverproxy.js");e("setdecoderslavesidecreator.js");r.alignParamsToTilesAndLevel=a.alignParamsToTilesAndLevel,r.prototype=Object.create(n.prototype),r.prototype.getTileWidth=function(){return this._tileWidth},r.prototype.getTileHeight=function(){return this._tileHeight},r.prototype.setServerRequestPrioritizerData=function(e){this._validateFetcher()},r.prototype.setDecodePrioritizerData=function(e){if(this._validateDecoder(),r.undefinedVar){if(null===this._decodePrioritizer)throw"No decode prioritizer has been set";this._showLog&&console.log("setDecodePrioritizerData("+e+")");var t=Object.create(e);t.image=this,this._decodePrioritizer.setPrioritizerData(t)}},r.prototype.open=function(e){this._validateFetcher();var t=this,i=this._fetchManager.open(e);return i.then(function(e){return t._internalSizesParams=e,{sizesParams:e,applicativeTileWidth:t.getTileWidth(),applicativeTileHeight:t.getTileHeight()}})},r.prototype.close=function(){this._validateFetcher(),this._validateDecoder();for(var e=0;e<this._decoders.length;++e)this._decoders[e].terminate();return this._fetchManager.close()},r.prototype.createChannel=function(){this._validateFetcher(),this.getImageParams();var e=this;return this._fetchManager.createChannel().then(function(t){return e._channelStates[t]={decodeJobsListenerHandle:null},t})},r.prototype.requestPixels=function(e){function t(t,n){a=t,s=n,o._requestsDecodeJobsPool.forkDecodeJobs(e,i,r)}function i(e){o._copyPixelsToAccumulatedResult(e,n)}function r(e){e?s("Request was aborted due to failure or priority"):a(n)}this._validateDecoder(),this.getImageParams();var a,s,n={},o=this,h=new Promise(t);return h},r.prototype.requestPixelsProgressive=function(e,t,i,r,a){this._validateDecoder(),this.getImageParams();var s,n=null;if(void 0===a)s=this._requestsDecodeJobsPool;else if(s=this._channelsDecodeJobsPool,n=this._channelStates[a],void 0===n)throw"Channel handle does not exist";var o=s.forkDecodeJobs(e,t,i,r);void 0!==a?(null!==n.decodeJobsListenerHandle&&s.unregisterForkedJobs(n.decodeJobsListenerHandle),n.decodeJobsListenerHandle=o,this._fetchManager.moveChannel(a,e)):this._fetchManager.createRequest(++this._fetchRequestId,e)},r.prototype.reconnect=function(){this._validateFetcher(),this._fetchManager.reconnect()},r.prototype.getImage=function(){return this._image},r.prototype._validateFetcher=function(){null===this._fetchManager&&(this._fetchManager=this._image.getFetchManager())},r.prototype._validateDecoder=function(){null===this._decodeDependencyWorkers&&(this._decodeDependencyWorkers=this._image.getDecoderWorkers(),this._requestsDecodeJobsPool=new s(this._decodeDependencyWorkers,this._tileWidth,this._tileHeight),this._channelsDecodeJobsPool=new s(this._decodeDependencyWorkers,this._tileWidth,this._tileHeight))},r.prototype._getImageParamsInternal=function(){return this._internalSizesParams},r.prototype._copyPixelsToAccumulatedResult=function(e,t){var i=4,r=e.width*i,a=e.originalRequestWidth*i;if(void 0===t.pixels){var s=a*e.originalRequestHeight;t.pixels=new Uint8Array(s),t.xInOriginalRequest=0,t.yInOriginalRequest=0;var n=e.originalRequestWidth;t.originalRequestWidth=n,t.width=n;var o=e.originalRequestHeight;t.originalRequestHeight=o,t.height=o}t.allRelevantBytesLoaded=e.allRelevantBytesLoaded;for(var h=0,l=e.xInOriginalRequest*i+e.yInOriginalRequest*a,c=0;c<e.height;++c){var u=e.pixels.subarray(h,h+r);t.pixels.set(u,l),h+=r,l+=a}}},{"decodejobspool.js":7,"imageHelperFunctions.js":11,"imageparamsretrieverproxy.js":15,"setdecoderslavesidecreator.js":17}],6:[function(e,t,i){"use strict";function r(e,t){this._isFirstStage=!0,this._listenerHandle=e,this._imagePartParams=t,this._allRelevantBytesLoaded=0;var i=e.imagePartParams;this._offsetX=t.minX-i.minX,this._offsetY=t.minY-i.minY,this._requestWidth=i.maxXExclusive-i.minX,this._requestHeight=i.maxYExclusive-i.minY}t.exports=r;e("linkedlist.js");r.prototype.onData=function(e){this._isFirstStage=!1;var t=e.allRelevantBytesLoaded-this._allRelevantBytesLoaded;this._allRelevantBytesLoaded=e.allRelevantBytesLoaded,this._listenerHandle.allRelevantBytesLoaded+=t;var i={originalRequestWidth:this._requestWidth,originalRequestHeight:this._requestHeight,xInOriginalRequest:this._offsetX,yInOriginalRequest:this._offsetY,imageData:e,allRelevantBytesLoaded:this._listenerHandle.allRelevantBytesLoaded};this._listenerHandle.callback(i)},r.prototype.onTerminated=function(){var e=--this._listenerHandle.remainingDecodeJobs;if(0>e)throw"Inconsistent number of done requests";var t=0===e;t&&(this._listenerHandle.isTerminatedCallbackCalled=!0,this._listenerHandle.terminatedCallback(this._listenerHandle.isAnyDecoderAborted))}},{"linkedlist.js":13}],7:[function(e,t,i){"use strict";function r(e,t,i){this._tileWidth=t,this._tileHeight=i,this._decodeDependencyWorkers=e}function a(e,t,i,r,a){if(void 0===a)return!1;for(var s=0;s<a.length;++s){var n=a[s],o=e>=n.minX&&i<=n.maxXExclusive,h=t>=n.minY&&r<=n.maxYExclusive;if(o&&h)return!0}return!1}t.exports=r;var s=e("decodejob.js");r.prototype.forkDecodeJobs=function(e,t,i,r){var n=e.minX,o=e.minY,h=e.maxXExclusive,l=e.maxYExclusive,c=e.level||0,u=e.quality,d=e.requestPriorityData,_=n%this._tileWidth===0&&o%this._tileHeight===0,m=h%this._tileWidth===0||h===e.levelWidth,g=l%this._tileHeight===0||l===e.levelHeight,p=h>n&&l>o;if(!(_&&m&&g&&p))throw"imagePartParams for decoders is not aligned to tile size or not in valid order";for(var v=Math.ceil((h-n)/this._tileWidth),f=Math.ceil((l-o)/this._tileHeight),y={imagePartParams:e,callback:t,terminatedCallback:i,remainingDecodeJobs:v*f,isAnyDecoderAborted:!1,isTerminatedCallbackCalled:!1,allRelevantBytesLoaded:0,unregisterHandles:[]},P=n;h>P;P+=this._tileWidth)for(var T=Math.min(P+this._tileWidth,e.levelWidth),w=o;l>w;w+=this._tileHeight){var C=Math.min(w+this._tileHeight,e.levelHeight),x=a(P,w,T,C,r);if(x)--y.remainingDecodeJobs;else{var E={minX:P,minY:w,maxXExclusive:T,maxYExclusive:C,levelWidth:e.levelWidth,levelHeight:e.levelHeight,level:c,quality:u,requestPriorityData:d},b=new s(y,E),I=this._decodeDependencyWorkers.startTask(E,b);y.unregisterHandles.push(I)}}return y.isTerminatedCallbackCalled||0!==y.remainingDecodeJobs||(y.isTerminatedCallbackCalled=!0,y.terminatedCallback(y.isAnyDecoderAborted)),y},r.prototype.unregisterForkedJobs=function(e){if(0!==e.remainingDecodeJobs)for(var t=0;t<e.unregisterHandles.length;++t)e.unregisterHandles[t].unregister()}},{"decodejob.js":6}],8:[function(e,t,i){"use strict";function r(e,t,i,a,s){this._fetcher=e,this._scheduler=t,this._scheduledJobsList=i,this._scheduledJobsListIterator=null,this._terminatedListeners=[],this._imagePartParams=null,this._state=r.FETCH_STATUS_WAIT_FOR_FETCH_CALL,this._isChannel=a===r.FETCH_TYPE_CHANNEL,this._contextVars=s,this._isOnlyWaitForData=a===r.FETCH_TYPE_ONLY_WAIT_FOR_DATA,this._useScheduler=a===r.FETCH_TYPE_REQUEST,this._resource=null,this._fetchHandle=null,this._fetchTerminatedBound=this._fetchTerminated.bind(this),a===r.FETCH_TYPE_CHANNEL?this._movableFetchState={}:this._movableFetchState=null}function a(e,t,i){if(null!==t._fetchHandle||null!==t._resource)throw"Unexpected restart of already started request";if(t._state===r.FETCH_STATUS_REQUEST_ABOUT_TO_ABORT)return void t._fetchTerminated(!0);if(t._state!==r.FETCH_STATUS_REQUEST_WAIT_FOR_SCHEDULE)throw"Unexpected state on schedule: "+t._state;t._resource=e,t._schedulerCallbacks=i,null!==e&&(t._scheduledJobsListIterator=t._scheduledJobsList.add(t)),t._startFetch()}function s(e,t){if(t.isChannel)throw"Unexpected call to continueYieldedRequest on channel";if(t._state===r.FETCH_STATUS_REQUEST_ABOUT_TO_ABORT||t._state===r.FETCH_STATUS_UNEXPECTED_FAILURE)return void t._schedulerCallbacks.jobDone();if(t._state!==r.FETCH_STATUS_REQUEST_YIELDED)throw"Unexpected request state on continue: "+t._state;t._state=r.FETCH_STATUS_ACTIVE,t._resource=e,t._scheduledJobsListIterator=t._scheduledJobsList.add(t),t._fetchHandle.resume()}function n(e){if(e._resource=null,e._scheduledJobsList.remove(e._scheduledJobsListIterator),e.state!==r.FETCH_STATUS_REQUEST_ABOUT_TO_YIELD)throw e._state=r.FETCH_STATUS_UNEXPECTED_FAILURE,"Unexpected request state on yield process: "+e._state;e._state=r.FETCH_STATUS_REQUEST_YIELDED}function o(e){e._resource=null,e._fetchTerminated(!0)}t.exports=r,r.FETCH_TYPE_REQUEST=1,r.FETCH_TYPE_CHANNEL=2,r.FETCH_TYPE_ONLY_WAIT_FOR_DATA=3,r.FETCH_STATUS_WAIT_FOR_FETCH_CALL=1,r.FETCH_STATUS_REQUEST_WAIT_FOR_SCHEDULE=2,r.FETCH_STATUS_ACTIVE=3,r.FETCH_STATUS_REQUEST_ABOUT_TO_YIELD=4,r.FETCH_STATUS_REQUEST_YIELDED=6,r.FETCH_STATUS_REQUEST_ABOUT_TO_ABORT=8,r.FETCH_STATUS_REQUEST_TERMINATED=9,r.FETCH_STATUS_UNEXPECTED_FAILURE=10,r.prototype.fetch=function(e){if(this._isChannel)return this._imagePartParams=e,void this._startFetch();if(null!==this._imagePartParams)throw'Cannot fetch twice on fetch type of "request"';if(this._state!==r.FETCH_STATUS_WAIT_FOR_FETCH_CALL)throw this._state=r.FETCH_STATUS_UNEXPECTED_FAILURE,"Unexpected state on fetch(): "+this._state;return this._imagePartParams=e,this._state=r.FETCH_STATUS_REQUEST_WAIT_FOR_SCHEDULE,this._useScheduler?void this._scheduler.enqueueJob(a,this,o):void a(null,this)},r.prototype.manualAbortRequest=function(){switch(this._state){case r.FETCH_STATUS_REQUEST_TERMINATED:case r.FETCH_STATUS_UNEXPECTED_FAILURE:return;case r.FETCH_STATUS_REQUEST_ABOUT_TO_ABORT:throw"Double call to manualAbortRequest()";case r.FETCH_STATUS_ACTIVE:var e=this;this._state=r.FETCH_STATUS_REQUEST_ABOUT_TO_ABORT,e._isOnlyWaitForData?e._fetchTerminated(!0):this._fetchHandle.stopAsync().then(function(){e._fetchTerminated(!0)});break;case r.FETCH_STATUS_WAIT_FOR_FETCH_CALL:return void(this._state=r.FETCH_STATUS_REQUEST_TERMINATED);case r.FETCH_STATUS_REQUEST_WAIT_FOR_SCHEDULE:case r.FETCH_STATUS_REQUEST_ABOUT_TO_YIELD:case r.FETCH_STATUS_REQUEST_YIELDED:this._state=r.FETCH_STATUS_REQUEST_ABOUT_TO_ABORT;break;default:throw"Unknown state in manualAbortRequest() implementation: "+this._state}},r.prototype.getContextVars=function(e){return this._contextVars},r.prototype.on=function(e,t){switch(e){case"terminated":this._terminatedListeners.push(t);break;default:throw"Unexpected event "+e}},r.prototype.setIsProgressive=function(e){this._isProgressive=e,null!==this._fetchHandle&&this._fetchHandle.setIsProgressive(e)},r.prototype.getIsProgressive=function(){return this._isProgressive},r.prototype._startFetch=function(){var e=this._state;this._state=r.FETCH_STATUS_ACTIVE,this._isOnlyWaitForData?this._fetchHandle=this._extractAlreadyFetchedData():this._isChannel?e!==r.FETCH_STATUS_WAIT_FOR_FETCH_CALL?this._fetchHandle=this._fetcher.moveFetch(this._imagePartParams,this._movableFetchState):this._fetchHandle=this._fetcher.startMovableFetch(this._imagePartParams,this._movableFetchState):this._fetchHandle=this._fetcher.fetch(this._imagePartParams),this._fetchHandle.on("terminated",this._fetchTerminatedBound),this._fetchHandle.setIsProgressive(this._isProgressive)},r.prototype._fetchTerminated=function(e){switch(this._state){case r.FETCH_STATUS_REQUEST_ABOUT_TO_ABORT:break;case r.FETCH_STATUS_ACTIVE:case r.FETCH_STATUS_REQUEST_ABOUT_TO_YIELD:if(e)throw this._state=r.FETCH_STATUS_UNEXPECTED_FAILURE,"Unexpected abort when fetch is active";break;default:throw"Unexpected state on fetch terminated: "+this._state}if(null!==this._resource){if(e)throw"Unexpected request termination without resource allocated";this._scheduledJobsList.remove(this._scheduledJobsListIterator),this._schedulerCallbacks.jobDone(),this._resource=null}else if(!e&&this._useScheduler)throw"Job expected to have resource on successful termination";if(!this._isChannel){this._state=r.FETCH_STATUS_REQUEST_TERMINATED;for(var t=0;t<this._terminatedListeners.length;++t)this._terminatedListeners[t](this._contextVars,e);null!==this._fetchHandle&&this._state!==r.FETCH_STATUS_UNEXPECTED_FAILURE&&(this._fetchHandle.dispose(),this._fetchHandle=null)}},r.prototype.checkIfShouldYield=function(){try{if(!this._useScheduler||this._state===r.FETCH_STATUS_REQUEST_TERMINATED)return;if(null===this._resource)throw"No resource allocated but fetch callback called";if(!this._schedulerCallbacks.shouldYieldOrAbort())return;this._state=r.FETCH_STATUS_REQUEST_ABOUT_TO_YIELD;var e=this;this._fetchHandle.stopAsync().then(function(){if(e._fetchState===r.FETCH_STATUS_REQUEST_ABOUT_TO_ABORT)return void e._fetchTerminated(!0);var t=e._schedulerCallbacks.tryYield(s,o,n);if(!t){if(e._state!==r.FETCH_STATUS_REQUEST_ABOUT_TO_YIELD)throw"Unexpected state on tryYield() false: "+e._state;e._state=r.FETCH_STATUS_ACTIVE,e._fetchHandle.resume()}})["catch"](function(){e._state=r.FETCH_STATUS_UNEXPECTED_FAILURE,o(e)})}catch(t){this._state=r.FETCH_STATUS_UNEXPECTED_FAILURE,o(this)}},Object.defineProperty(r.prototype,"imagePartParams",{get:function(){return this._imagePartParams}})},{}],9:[function(e,t,i){"use strict";function r(e,t){h.call(this),t=t||{};var i=t.serverRequestsLimit||5;if(this._fetcher=e,this._internalSizesParams=null,this._showLog=t.showLog,this._showLog)throw"showLog is not supported on this browser";if(!e.on)throw"ImageDecoderFramework error: Fetcher has no method on()";if(!e.open)throw"ImageDecoderFramework error: Fetcher has no method open()";if(!e.close)throw"ImageDecoderFramework error: Fetcher has no method close()";if(!e.reconnect)throw"ImageDecoderFramework error: Fetcher has no method reconnect()";if(!e.fetch)throw"ImageDecoderFramework error: Fetcher has no method fetch()";if(!e.moveFetch)throw"ImageDecoderFramework error: Fetcher has no method moveFetch()";if(!e.startMovableFetch)throw"ImageDecoderFramework error: Fetcher has no method startMovableFetch()";var r=n.createScheduler(t.showLog,t.serverRequestPrioritizer,"serverRequest",s,i);this._serverRequestPrioritizer=r.prioritizer,this._scheduler=r.scheduler,this._channelHandleCounter=0,this._channelHandles=[],this._requestById=[],this._scheduledJobsList=new l}function a(e,t){delete e.self._requestById[e.requestId]}function s(){return{}}t.exports=r;var n=e("imagehelperfunctions.js"),o=e("fetchjob.js"),h=e("imageparamsretrieverproxy.js"),l=e("linkedlist.js");r.prototype=Object.create(h.prototype),r.prototype.open=function(e){var t=this._fetcher.open(e),i=this;return t.then(function(e){return i._internalSizesParams=e,e})},r.prototype.on=function(e,t){this._fetcher.on(e,t)},r.prototype.close=function(){return this._fetcher.close()},r.prototype.setIsProgressiveRequest=function(e,t){var i=this._requestById[e];return void 0===i?null:void i.setIsProgressive(t)},r.prototype.createChannel=function(){var e=this;return new Promise(function(t,i){var r=++e._channelHandleCounter;e._channelHandles[r]=new o(e._fetcher,e._scheduler,e._scheduledJobsList,o.FETCH_TYPE_CHANNEL,null),t(r)})},r.prototype.moveChannel=function(e,t){var i=this._channelHandles[e];i.fetch(t)},r.prototype.createRequest=function(e,t){var i={progressiveStagesDone:0,isLastCallbackCalledWithoutLowQualityLimit:!1,requestId:e,fetchJob:null,self:this},r=o.FETCH_TYPE_REQUEST,s=new o(this._fetcher,this._scheduler,this._scheduledJobsList,r,i);if(i.fetchJob=s,void 0!==this._requestById[e])throw"Duplication of requestId "+e;void 0!==e&&(this._requestById[e]=s),s.on("terminated",a),s.fetch(t),this._yieldFetchJobs()},r.prototype.manualAbortRequest=function(e){var t=this._requestById[e];void 0!==t&&(t.manualAbortRequest(),delete this._requestById[e])},r.prototype.reconnect=function(){this._fetcher.reconnect()},r.prototype.setServerRequestPrioritizerData=function(e){if(null===this._serverRequestPrioritizer)throw"No serverRequest prioritizer has been set";this._showLog&&console.log("setServerRequestPrioritizerData("+e+")"),e.image=this,this._serverRequestPrioritizer.setPrioritizerData(e),this._yieldFetchJobs()},r.prototype._getImageParamsInternal=function(){return this._internalSizesParams},r.prototype._yieldFetchJobs=function(){for(var e=this._scheduledJobsList.getFirstIterator();null!==e;){var t=this._scheduledJobsList.getValue(e);e=this._scheduledJobsList.getNextIterator(e),t.checkIfShouldYield()}}},{"fetchjob.js":8,"imagehelperfunctions.js":12,"imageparamsretrieverproxy.js":15,"linkedlist.js":13}],10:[function(e,t,i){"use strict";function r(e,t){this._frustumData=null,this._isAbortRequestsNotInFrustum=e,this._isPrioritizeLowProgressiveStage=t}t.exports=r;var a=-1,s=0,n=1,o=2,h=3,l=4,c=5,u=6,d=7,_=5,m=13;Math.log(2);Object.defineProperty(r.prototype,"minimalLowQualityPriority",{get:function(){return l+_}}),r.prototype.setPrioritizerData=function(e){this._frustumData=e;
},r.prototype.getPriority=function(e){var t=e.imagePartParams;if(t.requestPriorityData.overrideHighestPriority)return m;var i=this._getPriorityInternal(t),r=i>=l;if(this._isAbortRequestsNotInFrustum&&!r)return a;var s=0;return this._isPrioritizeLowProgressiveStage&&r&&(s=0===e.progressiveStagesDone?_:1===e.progressiveStagesDone?1:0),i+s},r.prototype._getPriorityInternal=function(e){if(null===this._frustumData)return s;if(void 0===this._frustumData.imageRectangle)throw"No imageRectangle information passed in setPrioritizerData";var t=this._frustumData.exactlevel;if(void 0===this._frustumData.exactlevel)throw"No exactlevel information passed in setPrioritizerData. Use null if unknown";var i,r=this._pixelToCartographicX(e.minX,e),a=this._pixelToCartographicX(e.maxXExclusive,e),_=this._pixelToCartographicY(e.minY,e),m=this._pixelToCartographicY(e.maxYExclusive,e),g=e.maxXExclusive-e.minX,p=e.maxYExclusive-e.minY,v=e.level||0;if(null===t){var f=g/(a-r),y=p/(_-m),P=Math.max(f,y),T=this._frustumData.resolution;if(i=P/T,i>2)return n}else if(t>v)return n;var w=this._frustumData.rectangle,C=Math.max(w.west,r),x=Math.min(w.east,a),E=Math.max(w.south,m),b=Math.min(w.north,_),I=x-C,S=b-E;if(0>I||0>S)return o;if(null!==t){if(v>t)return h}else if(v>0&&.25>i)return h;var H=I*S,F=(a-r)*(_-m),D=H/F;return D>.99?d:D>.7?u:D>.3?c:l},r.prototype._pixelToCartographicX=function(e,t){var i=e/t.levelWidth,r=this._frustumData.imageRectangle,a=r.east-r.west,s=r.west+i*a;return s},r.prototype._pixelToCartographicY=function(e,t,i){var r=e/t.levelHeight,a=this._frustumData.imageRectangle,s=a.north-a.south,n=a.north-r*s;return n}},{}],11:[function(e,t,i){"use strict";function r(e,t){var i=t.x*t.x+t.y*t.y,r=e.east-e.west,a=e.north-e.south,s=r*r+a*a,n=Math.sqrt(i/s),o={resolution:n,rectangle:e,screenSize:t};return o}function a(e,t,i,r,a){var s,n;if(void 0===t)s=null,n=new ResourceScheduler.LifoScheduler(r,a);else{var h=!1;"frustum"===t?(h=!0,s=new o):"frustumOnly"===t?(h=!0,s=new o(!0,!0)):s=t;var l={schedulerName:i,showLog:e};h&&(l.resourceGuaranteedForHighPriority=a-2,l.highPriorityToGuaranteeResource=s.minimalLowQualityPriority),n=new ResourceScheduler.PriorityScheduler(r,a,s,l)}return{prioritizer:s,scheduler:n}}function s(e,t,i){if(i){var r=e.east-e.west,a=e.north-e.south,s=t.getImageWidth()/t.getImageHeight(),n=r/a;if(n>s){var o=r;r=a*s;var h=o-r;e.east-=h/2,e.west+=h/2}else{var l=a;a=r/s;var c=l-a;e.north-=c/2,e.south+=c/2}}}function n(e,t,i){var r=t.getTileWidth(),a=t.getTileHeight(),s=e.minX,n=e.minY,o=e.maxXExclusive,h=e.maxYExclusive,l=e.screenWidth,c=e.screenHeight,u=o>s&&h>n;if(!u)throw"Parameters order is invalid";var d=t.getImageWidth(),_=t.getImageHeight();if(0>o||s>=d||0>h||n>=_)return null;var m=i.getLevel(e),g=i.getLevelWidth(m),p=i.getLevelHeight(m),v=d/g,f=_/p,y=Math.floor(s/(v*r)),P=Math.floor(n/(f*a)),T=Math.ceil(o/(v*r)),w=Math.ceil(h/(f*a)),C=y*r,x=P*a,E=T*r,b=w*a,I=Math.max(0,Math.min(g,C)),S=Math.max(0,Math.min(p,x)),H=Math.max(0,Math.min(g,E)),F=Math.max(0,Math.min(p,b)),D=l/(E-C),R=c/(b-x),L={minX:I,minY:S,maxXExclusive:H,maxYExclusive:F,levelWidth:g,levelHeight:p,level:m},U={minX:I*v,minY:S*f,maxXExclusive:H*v,maxYExclusive:F*f},A={minX:Math.floor((I-C)*D),minY:Math.floor((S-x)*R),maxXExclusive:Math.ceil((H-C)*D),maxYExclusive:Math.ceil((F-x)*R)};return{imagePartParams:L,positionInImage:U,croppedScreen:A}}var o=e("frustumrequestsprioritizer.js");t.exports={calculateFrustum2DFromBounds:r,createScheduler:a,fixBounds:s,alignParamsToTilesAndLevel:n}},{"frustumrequestsprioritizer.js":10}],12:[function(e,t,i){arguments[4][11][0].apply(i,arguments)},{dup:11,"frustumrequestsprioritizer.js":10}],13:[function(e,t,i){"use strict";function r(){this._first={_prev:null,_parent:this},this._last={_next:null,_parent:this},this._count=0,this._last._prev=this._first,this._first._next=this._last}t.exports=r,r.prototype.add=function(e,t){null!==t&&void 0!==t||(t=this._last),this._validateIteratorOfThis(t),++this._count;var i={_value:e,_next:t,_prev:t._prev,_parent:this};return i._prev._next=i,t._prev=i,i},r.prototype.remove=function(e){this._validateIteratorOfThis(e),--this._count,e._prev._next=e._next,e._next._prev=e._prev,e._parent=null},r.prototype.getValue=function(e){return this._validateIteratorOfThis(e),e._value},r.prototype.getFirstIterator=function(){var e=this.getNextIterator(this._first);return e},r.prototype.getLastIterator=function(){var e=this.getPrevIterator(this._last);return e},r.prototype.getNextIterator=function(e){return this._validateIteratorOfThis(e),e._next===this._last?null:e._next},r.prototype.getPrevIterator=function(e){return this._validateIteratorOfThis(e),e._prev===this._first?null:e._prev},r.prototype.getCount=function(){return this._count},r.prototype._validateIteratorOfThis=function(e){if(e._parent!==this)throw"iterator must be of the current LinkedList"}},{}],14:[function(e,t,i){"use strict";function r(){AsyncProxy.AsyncProxySlave.setSlaveSideCreator(function(){var e=new Array(arguments.length+1);e[0]=null;for(var t=0;t<arguments.length;++t)e[t+1]=arguments[t];var i=new(Function.prototype.bind.apply(imageDecoderFramework.ImageDecoder,e));return i})}e("imagedecoder.js");t.exports.getScriptUrl=function(){return s};var a=new Blob(["(",r.toString(),")()"],{type:"application/javascript"}),s=URL.createObjectURL(a)},{"imagedecoder.js":5}],15:[function(e,t,i){"use strict";function r(){this._sizesParams=null}t.exports=r,r.prototype.getImageLevel=function(){var e=this.getImageParams();return e.imageLevel},r.prototype.getImageWidth=function(){var e=this.getImageParams();return e.imageWidth},r.prototype.getImageHeight=function(){var e=this.getImageParams();return e.imageHeight},r.prototype.getNumResolutionLevelsForLimittedViewer=function(){var e=this.getImageParams();return e.numResolutionLevelsForLimittedViewer},r.prototype.getLowestQuality=function(){var e=this.getImageParams();return e.lowestQuality},r.prototype.getHighestQuality=function(){var e=this.getImageParams();return e.highestQuality},r.prototype.getImageParams=function(){if(!this._sizesParams){if(this._sizesParams=this._getImageParamsInternal(),!this._sizesParams)throw"getImageParamsInternal() returned falsy value; Maybe image not ready yet?";if(void 0===this._sizesParams.imageLevel)throw"getImageParamsInternal() result has no imageLevel property";if(void 0===this._sizesParams.imageWidth)throw"getImageParamsInternal() result has no imageWidth property";if(void 0===this._sizesParams.imageHeight)throw"getImageParamsInternal() result has no imageHeight property";if(void 0===this._sizesParams.numResolutionLevelsForLimittedViewer)throw"getImageParamsInternal() result has no numResolutionLevelsForLimittedViewer property";if(void 0===this._sizesParams.lowestQuality)throw"getImageParamsInternal() result has no lowestQuality property";if(void 0===this._sizesParams.highestQuality)throw"getImageParamsInternal() result has no highestQuality property"}return this._sizesParams},r.prototype._getImageParamsInternal=function(){throw"ImageParamsRetrieverProxy inheritor did not implement _getImageParamsInternal()"}},{}],16:[function(e,t,i){"use strict";function r(){function e(e,i,r){if("callback"===e&&"statusCallback"===i){if(t||!r[0].isReady)return null;var a={sizesParams:this.getImageParams()};this.getTileWidth&&(a.applicativeTileWidth=this.getTileWidth()),this.getTileHeight&&(a.applicativeTileHeight=this.getTileHeight()),AsyncProxy.AsyncProxySlave.sendUserDataToMaster(a),t=!0}}var t=!1;AsyncProxy.AsyncProxySlave.setBeforeOperationListener(e)}t.exports.getScriptUrl=function(){return s};var a=new Blob(["(",r.toString(),")()"],{type:"application/javascript"}),s=URL.createObjectURL(a)},{}],17:[function(e,t,i){"use strict";function r(){AsyncProxy.AsyncProxySlave.setSlaveSideCreator(function(e){var t=imageDecoderFramework.Internals.imageHelperFunctions.getImageImplementation(e.imageImplementationClassName);return t.createPixelsDecoder()})}t.exports.getScriptUrl=function(){return s};var a=(e("imagehelperfunctions.js"),new Blob(["(",r.toString(),")()"],{type:"application/javascript"})),s=URL.createObjectURL(a)},{"imagehelperfunctions.js":12}],18:[function(e,t,i){"use strict";function r(e,t){o.call(this),this._imageWidth=null,this._imageHeight=null,this._tileWidth=0,this._tileHeight=0;var i=a.createInternalOptions(e,t),r=[e,i],h=a.getScriptsForWorkerImport(this._imageImplementation,t);h=h.concat([s.getScriptUrl(),n.getScriptUrl()]),this._workerHelper=new AsyncProxy.AsyncProxyMaster(h,"imageDecoderFramework.ImageDecoder",r);var l=this._imageOpened.bind(this);this._workerHelper.setUserDataHandler(l)}t.exports=r;var a=e("imagehelperfunctions.js"),s=e("sendimageparameterstomaster.js"),n=e("createimagedecoderonslaveside.js"),o=e("imageparamsretrieverproxy.js");r.prototype=Object.create(o.prototype),r.prototype.getTileWidth=function(){return this.getImageParams(),this._tileWidth},r.prototype.getTileHeight=function(){return this.getImageParams(),this._tileHeight},r.prototype.open=function(e){var t=this;return this._workerHelper.callFunction("open",[e],{isReturnPromise:!0}).then(function(e){return t._imageOpened(e),e})},r.prototype.close=function(){return this._workerHelper.callFunction("close",[],{isReturnPromise:!0})},r.prototype.createChannel=function(){this._workerHelper.callFunction("createChannel",[],{isReturnPromise:!0})},r.prototype.requestPixels=function(e){var t=["data","buffer"],i=[t],r=[e];this._workerHelper.callFunction("requestPixels",r,{isReturnPromise:!0,pathsToTransferablesInPromiseResult:i})},r.prototype.requestPixelsProgressive=function(e,t,i,r,a){function s(e){c._workerHelper.freeCallback(o),i(e)}var n,o=this._workerHelper.wrapCallback(t,"requestPixelsProgressiveCallback",{isMultipleTimeCallback:!0,pathsToTransferables:n}),h=this._workerHelper.wrapCallback(s,"requestPixelsProgressiveTerminatedCallback",{isMultipleTimeCallback:!1}),l=[e,o,h,r,a];this._workerHelper.callFunction("requestPixelsProgressive",l);var c=this},r.prototype.setServerRequestPrioritizerData=function(e){this._workerHelper.callFunction("setServerRequestPrioritizerData",[e],{isSendImmediately:!0})},r.prototype.setDecodePrioritizerData=function(e){this._workerHelper.callFunction("setDecodePrioritizerData",[e],{isSendImmediately:!0})},r.prototype.reconnect=function(){this._workerHelper.callFunction("reconnect")},r.prototype.alignParamsToTilesAndLevel=function(e){return a.alignParamsToTilesAndLevel(e,this)},r.prototype._imageOpened=function(e){this._internalSizesParams=e.sizesParams,this._tileWidth=e.applicativeTileWidth,this._tileHeight=e.applicativeTileHeight,this.getImageParams()},r.prototype._getImageParamsInternal=function(){return this._internalSizesParams}},{"createimagedecoderonslaveside.js":14,"imagehelperfunctions.js":12,"imageparamsretrieverproxy.js":15,"sendimageparameterstomaster.js":16}],19:[function(e,t,i){"use strict";function r(e,t,i){if(this._canvasUpdatedCallback=t,this._adaptProportions=i.adaptProportions,this._cartographicBounds=i.cartographicBounds,this._isMainImageOnUi=i.isMainImageOnUi,this._showLog=i.showLog,this._allowMultipleChannelsInSession=i.allowMultipleChannelsInSession,this._minFunctionCallIntervalMilliseconds=i.minFunctionCallIntervalMilliseconds,this._overviewResolutionX=i.overviewResolutionX||100,this._overviewResolutionY=i.overviewResolutionY||100,this._lastRequestIndex=0,this._pendingUpdateViewArea=null,this._regions=[],this._targetCanvas=null,this._callPendingCallbacksBound=this._callPendingCallbacks.bind(this),this._createdChannelBound=this._createdChannel.bind(this),this._pendingCallbacksIntervalHandle=0,this._pendingCallbackCalls=[],this._canShowDynamicRegion=!1,void 0===this._cartographicBounds&&(this._cartographicBounds={west:-175,east:175,south:-85,north:85}),void 0===this._adaptProportions&&(this._adaptProportions=!0),this._decoder=e,this._image=e.getImage(),!this._image.getLevelCalculator)throw"Image.getLevelCalculator() is not implemented by image ctor argument!"}t.exports=r;var a=(e("imagedecoder.js"),e("workerproxyimagedecoder.js"),e("imagehelperfunctions.js")),s=1,n=2,o=0,h=1;r.prototype.setExceptionCallback=function(e){this._exceptionCallback=e},r.prototype.open=function(e){return this._decoder.open(e).then(this._opened.bind(this))["catch"](this._exceptionCallback)},r.prototype.close=function(){var e=this._decoder.close();return e["catch"](this._exceptionCallback),this._isReady=!1,this._canShowDynamicRegion=!1,this._targetCanvas=null,e},r.prototype.setTargetCanvas=function(e){this._targetCanvas=e},r.prototype.updateViewArea=function(e){if(null===this._targetCanvas)throw"Cannot update dynamic region before setTargetCanvas()";if(!this._canShowDynamicRegion)return void(this._pendingUpdateViewArea=e);var t=e.rectangle,i=e.screenSize,r={minX:t.west*this._scaleX+this._translateX,minY:t.north*this._scaleY+this._translateY,maxXExclusive:t.east*this._scaleX+this._translateX,maxYExclusive:t.south*this._scaleY+this._translateY,screenWidth:i.x,screenHeight:i.y},s=a.alignParamsToTilesAndLevel(r,this._decoder,this._levelCalculator),n=null===s;if(!n){s.imagePartParams.quality=this._quality;var o=void 0!==this._dynamicFetchParams&&this._isImagePartsEqual(s.imagePartParams,this._dynamicFetchParams.imagePartParams);if(!o){e.imageRectangle=this._cartographicBoundsFixed,e.exactlevel=s.imagePartParams.level,this._decoder.setDecodePrioritizerData(e),this._decoder.setServerRequestPrioritizerData(e),this._dynamicFetchParams=s;var l=!1,c=!this._allowMultipleChannelsInSession;this._fetch(h,s,l,c)}}},r.prototype.getBounds=function(){if(!this._isReady)throw"ViewerImageDecoder error: Image is not ready yet";return this._cartographicBoundsFixed},r.prototype._isImagePartsEqual=function(e,t){var i=void 0!==this._dynamicFetchParams&&e.minX===t.minX&&e.minY===t.minY&&e.maxXExclusive===t.maxXExclusive&&e.maxYExclusive===t.maxYExclusive&&e.level===t.level;return i},r.prototype._fetch=function(e,t,i,r){function a(i){x._tilesDecodedCallback(e,t,f,i)}function s(r){r&&h.requestPriorityData.overrideHighestPriority&&x._decoder.requestPixelsProgressive(t.imagePartParams,a,s,l),x._fetchTerminatedCallback(e,t.imagePartParams.requestPriorityData,r,i)}var n=++this._lastRequestIndex,h=t.imagePartParams;h.requestPriorityData=h.requestPriorityData||{},h.requestPriorityData.requestIndex=n;var l,c=t.positionInImage.minX,u=t.positionInImage.minY,d=t.positionInImage.maxXExclusive,_=t.positionInImage.maxYExclusive,m=(c-this._translateX)/this._scaleX,g=(d-this._translateX)/this._scaleX,p=(u-this._translateY)/this._scaleY,v=(_-this._translateY)/this._scaleY,f={west:m,east:g,north:p,south:v},y=!1,P=this._regions[e];if(void 0!==P){var T=h.level,w=P.imagePartParams.level;if(y=T===w,y&&P.donePartParams&&(l=[P.donePartParams]),e!==o){var C=this._checkIfRepositionNeeded(P,h,f);C&&this._notifyNewPendingCalls()}}var x=this,E=r?this._channelHandle:void 0;this._decoder.requestPixelsProgressive(t.imagePartParams,a,s,l,E)},r.prototype._fetchTerminatedCallback=function(e,t,i,r){var a=this._regions[e];void 0!==a&&(t.overrideHighestPriority||t.requestIndex===this._lastRequestIndex)&&(a.isDone=!i&&this._isReady,a.isDone&&(a.donePartParams=a.imagePartParams),r&&this._decoder.createChannel().then(this._createdChannelBound))},r.prototype._createdChannel=function(e){this._channelHandle=e,this._startShowingDynamicRegion()},r.prototype._startShowingDynamicRegion=function(){this._canShowDynamicRegion=!0,null!==this._pendingUpdateViewArea&&(this.updateViewArea(this._pendingUpdateViewArea),this._pendingUpdateViewArea=null)},r.prototype._tilesDecodedCallback=function(e,t,i,r){if(this._isReady){var a=this._regions[e];if(void 0===a)switch(a={},this._regions[e]=a,e){case h:a.canvas=this._targetCanvas;break;case o:a.canvas=document.createElement("canvas");break;default:throw"Unexpected regionId "+e}var n=t.imagePartParams;!n.requestPriorityData.overrideHighestPriority&&n.requestPriorityData.requestIndex<a.currentDisplayRequestIndex||(this._checkIfRepositionNeeded(a,n,i),this._pendingCallbackCalls.push({type:s,region:a,decoded:r}),this._notifyNewPendingCalls())}},r.prototype._checkIfRepositionNeeded=function(e,t,i){var r=e.imagePartParams,a=e.donePartParams,s=t.level,o=void 0===r||r.minX!==t.minX||r.minY!==t.minY||r.maxXExclusive!==t.maxXExclusive||r.maxYExclusive!==t.maxYExclusive||r.level!==s;if(!o)return!1;var h,l,c,u,d,_=!1;void 0!==r&&(u=t.levelWidth/r.levelWidth,d=t.levelHeight/r.levelHeight,l={minX:Math.max(r.minX*u,t.minX),minY:Math.max(r.minY*d,t.minY),maxX:Math.min(r.maxXExclusive*u,t.maxXExclusive),maxY:Math.min(r.maxYExclusive*d,t.maxYExclusive)},_=l.maxX>l.minX&&l.maxY>l.minY),_&&(h={fromX:l.minX/u-r.minX,fromY:l.minY/d-r.minY,fromWidth:(l.maxX-l.minX)/u,fromHeight:(l.maxY-l.minY)/d,toX:l.minX-t.minX,toY:l.minY-t.minY,toWidth:l.maxX-l.minX,toHeight:l.maxY-l.minY},a&&r.level===s&&(c={minX:Math.max(a.minX,t.minX),minY:Math.max(a.minY,t.minY),maxXExclusive:Math.min(a.maxXExclusive,t.maxXExclusive),maxYExclusive:Math.min(a.maxYExclusive,t.maxYExclusive)})),e.imagePartParams=t,e.isDone=!1,e.currentDisplayRequestIndex=t.requestPriorityData.requestIndex;var m={type:n,region:e,position:i,donePartParams:c,copyData:h,pixelsWidth:t.maxXExclusive-t.minX,pixelsHeight:t.maxYExclusive-t.minY};return this._pendingCallbackCalls.push(m),!0},r.prototype._notifyNewPendingCalls=function(){this._isNearCallbackCalled||this._callPendingCallbacks()},r.prototype._callPendingCallbacks=function(){if(0===this._pendingCallbackCalls.length||!this._isReady)return void(this._isNearCallbackCalled=!1);this._isNearCallbackCalled&&clearTimeout(this._pendingCallbacksIntervalHandle),void 0!==this._minFunctionCallIntervalMilliseconds&&(this._pendingCallbacksIntervalHandle=setTimeout(this._callPendingCallbacksBound,this._minFunctionCallIntervalMilliseconds),this._isNearCallbackCalled=!0);for(var e=null,t=0;t<this._pendingCallbackCalls.length;++t){var i=this._pendingCallbackCalls[t];if(i.type===n)this._repositionCanvas(i),e=i.position;else{if(i.type!==s)throw"Internal ViewerImageDecoder Error: Unexpected call type "+i.type;this._pixelsUpdated(i)}}this._pendingCallbackCalls.length=0,this._canvasUpdatedCallback(e)},r.prototype._pixelsUpdated=function(e){var t=e.region,i=e.decoded;if(0!==i.imageData.width&&0!==i.imageData.height){var r=i.xInOriginalRequest,a=i.yInOriginalRequest,s=t.canvas.getContext("2d");s.putImageData(i.imageData,r,a)}},r.prototype._repositionCanvas=function(e){var t,i=e.region,r=e.position,a=e.donePartParams,s=e.copyData,n=e.pixelsWidth,h=e.pixelsHeight,l=i.canvas.getContext("2d");void 0!==s&&(s.fromWidth===s.toWidth&&s.fromHeight===s.toHeight?t=l.getImageData(s.fromX,s.fromY,s.fromWidth,s.fromHeight):(this._tmpCanvas||(this._tmpCanvas=document.createElement("canvas"),this._tmpCanvasContext=this._tmpCanvas.getContext("2d")),this._tmpCanvas.width=s.toWidth,this._tmpCanvas.height=s.toHeight,this._tmpCanvasContext.drawImage(i.canvas,s.fromX,s.fromY,s.fromWidth,s.fromHeight,0,0,s.toWidth,s.toHeight),t=this._tmpCanvasContext.getImageData(0,0,s.toWidth,s.toHeight))),i.canvas.width=n,i.canvas.height=h,i!==this._regions[o]&&this._copyOverviewToCanvas(l,r,n,h),void 0!==s&&l.putImageData(t,s.toX,s.toY),i.position=r,i.donePartParams=a},r.prototype._copyOverviewToCanvas=function(e,t,i,r){var a=this._regions[o].position,s=this._regions[o].imagePartParams,n=s.maxXExclusive-s.minX,h=s.maxYExclusive-s.minY,l=a.east-a.west,c=a.north-a.south,u=n/l,d=h/c,_=t.east-t.west,m=t.north-t.south,g=_*u,p=m*d,v=t.west-a.west,f=a.north-t.north,y=v*u,P=f*d;e.drawImage(this._regions[o].canvas,y,P,g,p,0,0,i,r)},r.prototype._opened=function(){this._isReady=!0,this._levelCalculator=this._image.getLevelCalculator();var e={west:this._cartographicBounds.west,east:this._cartographicBounds.east,south:this._cartographicBounds.south,north:this._cartographicBounds.north};a.fixBounds(e,this._decoder,this._adaptProportions),this._cartographicBoundsFixed=e;var t=this._decoder.getImageWidth(),i=this._decoder.getImageHeight();this._quality=this._decoder.getHighestQuality();var r=e.east-e.west,s=e.north-e.south;this._scaleX=t/r,this._scaleY=-i/s,this._translateX=-e.west*this._scaleX,this._translateY=-e.north*this._scaleY;var n={minX:0,minY:0,maxXExclusive:t,maxYExclusive:i,screenWidth:this._overviewResolutionX,screenHeight:this._overviewResolutionY},h=a.alignParamsToTilesAndLevel(n,this._decoder,this._levelCalculator);h.imagePartParams.requestPriorityData=h.imagePartParams.requestPriorityData||{},h.imagePartParams.requestPriorityData.overrideHighestPriority=!0,h.imagePartParams.quality=this._decoder.getLowestQuality();var l=!this._allowMultipleChannelsInSession;this._fetch(o,h,l),this._allowMultipleChannelsInSession&&this._startShowingDynamicRegion()}},{"imagedecoder.js":5,"imagehelperfunctions.js":12,"workerproxyimagedecoder.js":18}],20:[function(e,t,i){"use strict";t.exports.ViewerImageDecoder=e("viewerimagedecoder.js"),t.exports.ImageDecoder=e("imagedecoder.js"),t.exports.FetchManager=e("fetchmanager.js"),t.exports.PromiseFetcherAdapter=e("promisefetcheradapter.js"),t.exports.CesiumImageDecoderLayerManager=e("_cesiumimagedecoderlayermanager.js"),t.exports.ImageDecoderImageryProvider=e("imagedecoderimageryprovider.js"),t.exports.ImageDecoderRegionLayer=e("imagedecoderregionlayer.js")},{"_cesiumimagedecoderlayermanager.js":2,"fetchmanager.js":9,"imagedecoder.js":5,"imagedecoderimageryprovider.js":4,"imagedecoderregionlayer.js":21,"promisefetcheradapter.js":23,"viewerimagedecoder.js":19}],21:[function(e,t,i){"use strict";function r(){return{initialize:function(e){if(this._options=e||{},void 0!==this._options.latLngBounds){this._options={};for(var t in e)this._options[t]=e[t];this._options.cartographicBounds={west:e.latLngBounds.getWest(),east:e.latLngBounds.getEast(),south:e.latLngBounds.getSouth(),north:e.latLngBounds.getNorth()}}this._targetCanvas=null,this._canvasPosition=null,this._canvasUpdatedCallbackBound=this._canvasUpdatedCallback.bind(this),this._viewerImageDecoder=null,this._exceptionCallback=null},setExceptionCallback:function(e){this._exceptionCallback=e,null!==this._viewerImageDecoder&&this._viewerImageDecoder.setExceptionCallback(e)},_createImage:function(){null===this._viewerImageDecoder&&(this._viewerImageDecoder=new a(this._options.imageDecoder,this._canvasUpdatedCallbackBound,this._options),null!==this._exceptionCallback&&this._viewerImageDecoder.setExceptionCallback(this._exceptionCallback),this._viewerImageDecoder.open(this._options.url)["catch"](this._exceptionCallback))},onAdd:function(e){if(void 0!==this._map)throw"Cannot add this layer to two maps";this._map=e,this._createImage(),this._targetCanvas=L.DomUtil.create("canvas","image-decoder-layer-canvas leaflet-zoom-animated"),this._viewerImageDecoder.setTargetCanvas(this._targetCanvas),this._canvasPosition=null,e.getPanes().mapPane.appendChild(this._targetCanvas),e.on("viewreset",this._moved,this),e.on("move",this._moved,this),L.Browser.any3d&&e.on("zoomanim",this._animateZoom,this),this._moved()},onRemove:function(e){if(e!==this._map)throw"Removed from wrong map";e.off("viewreset",this._moved,this),e.off("move",this._moved,this),e.off("zoomanim",this._animateZoom,this),e.getPanes().mapPane.removeChild(this._targetCanvas),this._targetCanvas=null,this._canvasPosition=null,this._map=void 0,this._viewerImageDecoder.close(),this._viewerImageDecoder=null},_moved:function(){this._moveCanvases();var e=s(this._map);this._viewerImageDecoder.updateViewArea(e)},_canvasUpdatedCallback:function(e){null!==e&&(this._canvasPosition=e,this._moveCanvases())},_moveCanvases:function(){if(null!==this._canvasPosition){var e=this._canvasPosition.west,t=this._canvasPosition.east,i=this._canvasPosition.south,r=this._canvasPosition.north,a=this._map.latLngToLayerPoint([r,e]),s=this._map.latLngToLayerPoint([i,t]),n=s.subtract(a);L.DomUtil.setPosition(this._targetCanvas,a),this._targetCanvas.style.width=n.x+"px",this._targetCanvas.style.height=n.y+"px"}},_animateZoom:function(e){if(null!==this._canvasPosition){var t=this._canvasPosition.west,i=this._canvasPosition.east,r=this._canvasPosition.south,a=this._canvasPosition.north,s=this._map._latLngToNewLayerPoint([a,t],e.zoom,e.center),n=this._map._latLngToNewLayerPoint([r,i],e.zoom,e.center),o=this._map.getZoomScale(e.zoom),h=n.subtract(s),l=h.multiplyBy(.5*(1-1/o)),c=s.add(l);this._targetCanvas.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(c)+" scale("+o+") "}}}}var a=e("viewerimagedecoder.js"),s=e("leafletfrustumcalculator.js");self.L?t.exports=L.Class.extend(r()):t.exports=function(){throw new Error("Cannot instantiate ImageDecoderRegionLayer: No Leaflet namespace in scope")}},{"leafletfrustumcalculator.js":22,"viewerimagedecoder.js":19}],22:[function(e,t,i){"use strict";var r=e("imagehelperfunctions.js");t.exports=function(e){var t=e.getSize(),i=e.getBounds(),a={west:i.getWest(),east:i.getEast(),south:i.getSouth(),north:i.getNorth()},s=r.calculateFrustum2DFromBounds(a,t);return s}},{"imagehelperfunctions.js":12}],23:[function(e,t,i){"use strict";function r(e,t){this._url=null,this._options=t||{},this._promiseFetcher=e,this._dataListeners=[],this._isReady=!1,this._activeFetches=0,this._resolveClose=null,this._rejectClose=null}t.exports=r;var a=e("promisefetcheradapterfetchhandle.js");r.prototype.open=function(e){var t=this;return this._promiseFetcher.open(e).then(function(e){return t._isReady=!0,e})},r.prototype.close=function(e){this._ensureReady(),this._isReady=!1;var t=this;return new Promise(function(e,i){t._resolveClose=e,t._rejectClose=i,t._checkIfClosed()})},r.prototype.reconnect=function(){this._ensureReady()},r.prototype.on=function(e,t){if("data"!==e)throw"PromiseFetcherAdapter: Unexpected event "+e+'. Expected "data"';this._dataListeners.push(t)},r.prototype.fetch=function(e){this._ensureReady(),++this._activeFetches;var t=new a(e),i=this;return this._promiseFetcher.fetch(e).then(function(e){i._afterFetch(t,e)})["catch"](function(e){i._afterFailedFetch(e)}),t},r.prototype.startMovableFetch=function(e,t){function i(r){if(null!==t._currentFetchHandle){var a=t._currentFetchHandle;t._currentFetchHandle=null,s._afterFetch(a,r)}return null!==t._pendingFetchHandle&&s._isReady&&(++s._activeFetches,t._currentFetchHandle=t._pendingFetchHandle,t._pendingFetchHandle=null,s._promiseFetcher.fetch(e).then(i)["catch"](i)),r}this._ensureReady();var r=new a(e),s=this;return t._currentFetchHandle=null,t._pendingFetchHandle=r,t._startNextFetch=i,i(),r},r.prototype.moveFetch=function(e,t){this._ensureReady();var i=new a(e);return null!==t._pendingFetchHandle&&t._pendingFetchHandle.terminate(!0),t._pendingFetchHandle=i,null===t._currentFetchHandle&&t._startNextFetch(),i},r.prototype._ensureReady=function(){if(!this._isReady)throw"PromiseFetcherAdapter error: fetch client is not opened"},r.prototype._checkIfClosed=function(){0!==this._activeFetches||this._isReady||this._resolveClose()},r.prototype._afterFetch=function(e,t){e.terminate(!1);var i=e.getImagePartParams();--this._activeFetches;for(var r=0;r<this._dataListeners.length;++r)this._dataListeners[r](t,i);return this._checkIfClosed(),t},r.prototype._afterFailedFetch=function(e){return--this._activeFetches,this._checkIfClosed(),e}},{"promisefetcheradapterfetchhandle.js":24}],24:[function(e,t,i){"use strict";function r(e){this._imagePartParams=e,this._stopPromise=null,this._terminatedListeners=[],this._isTerminated=!1,this._isDisposed=!1}t.exports=r,r.prototype.getImagePartParams=function(){return this._imagePartParams},r.prototype.terminate=function(e){if(this._isTerminated)throw"imageDecoderFramework error: FetchHandle double terminate";this._isTerminated=!0;for(var t=0;t<this._terminatedListeners.length;++t)this._terminatedListeners[t](e)},r.prototype.stopAsync=function(){if(null!==this._stopPromise){var e=this;this._stopPromise=new Promise(function(t,i){e.on("terminated",t)})}return this._stopPromise},r.prototype.setIsProgressive=function(e){},r.prototype.on=function(e,t){if("terminated"!==e)throw"imageDecoderFramework error: FetchHandle.on with unsupported event "+e+". Only terminated event is supported";this._terminatedListeners.push(t)},r.prototype.resume=function(){if(this._isTerminated)throw"imageDecoderFramework error: cannot resume stopped FetchHandle"},r.prototype.dispose=function(){if(!this._isTerminated)throw"imageDecoderFramework error: cannot dispose non-terminated FetchHandle";if(this._isDisposed)throw"imageDecoderFramework error: FetchHandle double dispose";this._isDisposed=!0}},{}]},{},[20])(20)});